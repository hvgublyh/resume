---
title: 多表连接查询和子查询
updated: 2019-09-18T16:06:56
created: 2019-07-31T15:59:26
---

一、多表连接查询
1、natural join 自然连接

自然连接是一种特殊的等值连接，要求两个关系表中进行比较的必须是相同的属性列，不需要添加连接条件，并且在结果中消除重复的属性列。

2、inner join（内连接也叫等值连接）

只返回连接字段相等的行，不消除重复的属性列

select \* from t1 inner join t2 on t1.c=t2.c

--查询emp表中工资\>2000的员工的姓名、部门名称、工作、工资

select e.ename,d.dname,e.job,e.sal from emp e natural join dept d where e.sal\>2000;

--查询学生姓名及对应的课程编号和成绩

select stu.sname,sco.courseid,sco.score

from students stu inner join score sco on stu.scode=sco.studentid

--查询学生姓名及对应课程名称和成绩（三张表进行连接）

select stu.sname,c.coursename,sco.score

from students stu inner join score sco on stu.scode=sco.studentid inner join course c on c.courseid=sco.courseid

注意：三表连接查询，先将两张表做连接，再连接第三张表

3、右连接

返回右表中的所有数据和左表中符合连接条件的数据

--查询出每个部门下的员工姓名、工资

select t.deptno,e.ename,e.sal

from emp e right join dept t on e.deptno=t.deptno

order by t.deptno;

4、左连接

返回左表中的所有数据和右表中符合连接条件的数据

--查询出每个部门下的员工姓名、工资

select t.deptno,e.ename,e.sal

from emp e left join dept t on e.deptno=t.deptno

order by t.deptno;

5、全连接

返回两张表中的所有数据，不以谁为基础，除了显示符合条件的记录也显示不符合条件的记录

--全连接

select \* from t1 full join t2 on t1.c= t2.c;
二、子查询
子查询是指在select、update 、delete语句内部可以出现select语句。内部的select语句可以作为外部查询的条件子句的一部分，也可以作为外部查询的临时表。

1、单行子查询

--查询出销售部（SALES）下的员工、工作、工资

select e.ename,e.job,e.sal

from emp e

where e.deptno=(select d.deptno from dept d where d.dname='SALES')

2、in子查询

--查询成绩大于80分的学生信息

select stu.\*

from students stu

where stu.scode in (select sc.studentid from score sc where sc.score\>80)

--查询参加考试的学生信息

select \* from students s where s.scode in

(select distinct sc.studentid from score sc)

3、not in子查询

--查询参加没考试的学生信息

select \* from students s where s.scode not in

(select distinct sc.studentid from score sc)

4、Oracle中的伪列

在Oracle的表的使用过程中，实际表中还有一些附加的列，称之为伪列

伪列就像表中的列一样，但是并不真正存储。伪列只能查询，不能增删改。

我们要学习两个伪列：rowid 和rownum

5、rowid

rowid是一行数据的物理地址

6、rownum

rownum为查询结果集中的列号

1、rowid时存储数据时形成

2、rownum查询数据时形成

3、rowid是物理地址

4、rownum是行号

--查询出emp表中前5名员工的姓名、工作、工资

select rownum,e.ename,e.job,e.sal from emp e where rownum\<=5

--查询出工资最高的前5名员工的姓名、工作、工资

select \*

from (select e.ename,e.job,e.sal

from emp e order by e.sal desc) t

where rownum\<=5;

--查询出工资最高的6-10条数据

select \*

from (select e.\*,rownum as r from emp e order by e.sal desc)t

where r \<=10 and r\>=6;

在服务器读取行数据时，rownum总是从1开始的，为了固定第6-10条数据位置，设置行数据rownum as r

7、union

用于合并两个或多个结果集

--union

select t1.c from t1 union （all) select t2.c from t2;

注意：union在合并结果集时会自动过滤掉重复记录，union all不会。

一次性插入多行：

insert into t1(a,b,c) select 1,2,3 from dual union

select 2,3,4 from dual

作业难题解答：
--3．列出所有员工的姓名及其直接上级的姓名。
select e1.ename,e2.ename from emp e1 inner join emp e2 on e1.mgr=e2.empno;
--12．列出在每个部门工作的员工数量、平均工资。
select deptno, count(empno) as num, avg(sal) as avg_s
from emp
group by deptno;
--14．列出所有部门的详细信息和部门人数。
select d.\*, t.num
from dept d, (select deptno, count(empno) num from emp group by deptno) t
where d.deptno = t.deptno;

