---
title: 查询和常用函数
updated: 2019-08-16T09:36:07
created: 2019-07-31T08:53:11
---

查询和常用函数
2019年7月31日
8:53
一、什么是查询
客户端发出查询请求，服务器接收到请求，将查询结果返回给客户端，查询产生一个虚拟表，我们看到的只是以表的形式显示的结果，但结果并不真正存储，每次查询都只是现从数据库表里提取数据，并按表的形式显示出来。

二、 Oracle常用函数
1、单行函数

每次只能对一行数据进行操作

1）字符函数：对字符串进行操作

--ascii(x)返回x的ASCII码

select ascii('a') from dual;--97

--concat(x,y)

select concat('Hello',',Furou') from dual; --Hello,Furou

--instr(x,str)返回str在x中首次出现的位置

select instr('hello world', 'or') from dual;--8

--instr(x,str\[,start\]\[,n\])返回str在x中首次出现的位置

select instr('hello world', 'or',1,2) from dual;--12

\[,start\]\[,n\]分别代表开始查找位置、第n次出现，可无。

--length(x)返回字符串的长度

select length('hello') from dual; --5

--lower(x)将x转化为小写

select lower('HELLO') from dual; --hello

--upper(x)将x转化为大写

select upper('hello') from dual; --HELLO

--ltrim(x\[,str\]截去x左边的str，缺省截去左边空格

select ltrim('==hello==','=') from dual; --hello==

select ltrim(' hello==','=') from dual; --hello==

--rtrim(x\[,str\]截去x右边的str，缺省截去右边空格

select rtrim('==hello==','=') from dual; --==hello

select rtrim(' hello ==','=') from dual; --hello

--trim(\[str from\]x)截去x两侧的str，缺省截去两侧空格

select trim('='from '==hello==') from dual; --hello==

select trim(' hello ') from dual; --hello

--replace(x,old,new)在x中查找old并替换为new

select replace('abcd', 'b', 's') from dual;

--substr(x,start\[,length\])从start位置处开始截取x，长度为length

select substr('abcdef', 2，2) from dual;--bc

2）数值函数：对数值进行操作

--abs(x)取x的绝对值

select abs(-2) from dual;--2

select abs(2) from dual;--2

--acos(x)取x的反余弦

select acos(1) from dual;--0

--cos(x)取x的余弦

select cos(0) from dual; --1

--ceil(x)返回大于等于x的最小整数

select ceil(5.8) from dual;--6

--floor(x)返回小于等于x的最大整数

select floor(5.6) from dual; --5

--log(x,y)取以x为底的y的对数

select log(2,4) from dual; --2

--mod(x,y)取x除以y的余数

select mod(8,3) from dual; --2

--power(x,y)取x的y次幂

select power(2,3) from dual; --8

--round(x\[,y\])正数代表保留小数位数，负数代表从小数点往前数y的绝对值位数，在该位进行四舍五入

select round(5.4) from dual;--5

select round(5.647,2) from dual;--5.65

select round(445.647,-2) from dual;--400

--trunc(x\[,y\])正数代表保留小数位数，负数代表从小数点往前数y的绝对值位数，在该位不再进行四舍五入

select round(5.4) from dual;--5

select round(5.647,2) from dual;--5.64

select round(499.999,-2) from dual;--400

3）转换函数

--to_date()转换为时间格式

select to_date('2019-7-31','yyyy-mm-dd') from dual; --2019/7/31

--to_char()转化为字符串格式

select to_char(123.456,'999.999') from dual; --123.456

--to_number()数值类型

select to_number('123.456') from dual;--123.456

--months_between(x,y)取x和y之间的月份差

select months_between (to_date('2019-12-12','yyyy-mm-dd'),to_date('2019-6-12','yyyy-mm-dd')) from dual;

--add_months(x,y)返回在x 的基础上加上y个月

select add_months(to_date('2019-5-12','yyyy-mm-dd'),2) from dual; --2019/7/12

--next_day(x,y)返回日期x之后的星期几对应的新日期

select next_day(to_date('2019-7-31','yyyy-mm-dd'),'星期六') from dual;--2019/8/3

--last_day(x)返回日期x所在月的最后一天

select last_day(to_date('2019-7-10','yyyy-mm-dd')) from dual;--2019/7/31

--round(x,y)返回日期四舍五入时间

select round(sysdate,'YEAR') from dual;--2020/1/1

--trunc(x,y)返回日期四舍五入时间

select trunc(sysdate,'YEAR') from dual;--2019/1/1

|  |  |
|----|----|
| --nvl 为空值赋值 | 从emp表员工姓名、工作、工资、奖金，如果员工没有工资，则显示0； |
select ename,job,sal,nvl(comm,0) from emp where comm is null;

3、聚合函数
每次可以对多行数据进行操作

--sum求和，avg求平均值，max求最大值，min求最小值，count求数值个数

select sum(sal),avg(sal),max(sal),min(sal),count(\*) from emp;

三、分组查询 group by
--查询各部门的部门编号及平均工资

select \* from emp;

select e.deptno,round(avg(sal),2) from emp e

group by e.deptno;

注意：在含有group by 的查询语句中，select的参数只能是聚合函数或group by参数。
四、分组查询 having
--查询emp表中部门平均工资\>2000的部门编号及平均工资

select e.deptno ,trunc(avg(sal),2) from emp e group by e.deptno having avg(sal)\>2000;

执行顺序：from-where -group by -having-order by

where：从数据源中选取符合条件 的行数据

group by：将行数据按照某种条件进行分组，聚合函数为各种计算统计值

having：从各种组中选取符合条件的各种数据
